(function(h,T){typeof exports=="object"&&typeof module<"u"?T(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],T):(h=typeof globalThis<"u"?globalThis:h||self,T(h["configcat-vue"]={},h.Vue))})(this,function(h,T){"use strict";var ce;(function(n){n[n.Fetched=0]="Fetched",n[n.NotModified=1]="NotModified",n[n.Errored=2]="Errored"})(ce||(ce={}));class I{constructor(e,t,i,s){this.status=e,this.config=t,this.errorMessage=i,this.errorException=s}static success(e){return new I(0,e)}static notModified(e){return new I(1,e)}static error(e,t,i){return new I(2,e,t??"Unknown error.",i)}}class N extends Error{constructor(e,...t){super(((i,s)=>{switch(i){case"abort":return"Request was aborted.";case"timeout":const[r]=s;return`Request timed out. Timeout value: ${r}ms`;case"failure":const[o]=s,a="Request failed due to a network or protocol error.";return o?a+" "+(o instanceof Error?o.message:o+""):a}})(e,t)),this.cause=e,this instanceof N||(Object.setPrototypeOf||((i,s)=>i.__proto__=s))(this,N.prototype),this.args=t}}var ue;(function(n){n[n.No=0]="No",n[n.Should=1]="Should",n[n.Force=2]="Force"})(ue||(ue={})),h.SettingType=void 0,function(n){n[n.Boolean=0]="Boolean",n[n.String=1]="String",n[n.Int=2]="Int",n[n.Double=3]="Double"}(h.SettingType||(h.SettingType={})),h.UserComparator=void 0,function(n){n[n.TextIsOneOf=0]="TextIsOneOf",n[n.TextIsNotOneOf=1]="TextIsNotOneOf",n[n.TextContainsAnyOf=2]="TextContainsAnyOf",n[n.TextNotContainsAnyOf=3]="TextNotContainsAnyOf",n[n.SemVerIsOneOf=4]="SemVerIsOneOf",n[n.SemVerIsNotOneOf=5]="SemVerIsNotOneOf",n[n.SemVerLess=6]="SemVerLess",n[n.SemVerLessOrEquals=7]="SemVerLessOrEquals",n[n.SemVerGreater=8]="SemVerGreater",n[n.SemVerGreaterOrEquals=9]="SemVerGreaterOrEquals",n[n.NumberEquals=10]="NumberEquals",n[n.NumberNotEquals=11]="NumberNotEquals",n[n.NumberLess=12]="NumberLess",n[n.NumberLessOrEquals=13]="NumberLessOrEquals",n[n.NumberGreater=14]="NumberGreater",n[n.NumberGreaterOrEquals=15]="NumberGreaterOrEquals",n[n.SensitiveTextIsOneOf=16]="SensitiveTextIsOneOf",n[n.SensitiveTextIsNotOneOf=17]="SensitiveTextIsNotOneOf",n[n.DateTimeBefore=18]="DateTimeBefore",n[n.DateTimeAfter=19]="DateTimeAfter",n[n.SensitiveTextEquals=20]="SensitiveTextEquals",n[n.SensitiveTextNotEquals=21]="SensitiveTextNotEquals",n[n.SensitiveTextStartsWithAnyOf=22]="SensitiveTextStartsWithAnyOf",n[n.SensitiveTextNotStartsWithAnyOf=23]="SensitiveTextNotStartsWithAnyOf",n[n.SensitiveTextEndsWithAnyOf=24]="SensitiveTextEndsWithAnyOf",n[n.SensitiveTextNotEndsWithAnyOf=25]="SensitiveTextNotEndsWithAnyOf",n[n.SensitiveArrayContainsAnyOf=26]="SensitiveArrayContainsAnyOf",n[n.SensitiveArrayNotContainsAnyOf=27]="SensitiveArrayNotContainsAnyOf",n[n.TextEquals=28]="TextEquals",n[n.TextNotEquals=29]="TextNotEquals",n[n.TextStartsWithAnyOf=30]="TextStartsWithAnyOf",n[n.TextNotStartsWithAnyOf=31]="TextNotStartsWithAnyOf",n[n.TextEndsWithAnyOf=32]="TextEndsWithAnyOf",n[n.TextNotEndsWithAnyOf=33]="TextNotEndsWithAnyOf",n[n.ArrayContainsAnyOf=34]="ArrayContainsAnyOf",n[n.ArrayNotContainsAnyOf=35]="ArrayNotContainsAnyOf"}(h.UserComparator||(h.UserComparator={})),h.PrerequisiteFlagComparator=void 0,function(n){n[n.Equals=0]="Equals",n[n.NotEquals=1]="NotEquals"}(h.PrerequisiteFlagComparator||(h.PrerequisiteFlagComparator={})),h.SegmentComparator=void 0,function(n){n[n.IsIn=0]="IsIn",n[n.IsNotIn=1]="IsNotIn"}(h.SegmentComparator||(h.SegmentComparator={}));const yt=Object.freeze(Object.defineProperty({__proto__:null,get PrerequisiteFlagComparator(){return h.PrerequisiteFlagComparator},get RedirectMode(){return ue},get SegmentComparator(){return h.SegmentComparator},get SettingType(){return h.SettingType},get UserComparator(){return h.UserComparator}},Symbol.toStringTag,{value:"Module"}));class S{static equals(e,t){return e.httpETag&&t.httpETag?e.httpETag===t.httpETag:e.configJson===t.configJson}constructor(e,t,i,s){this.configJson=e,this.config=t,this.timestamp=i,this.httpETag=s}with(e){return new S(this.configJson,this.config,e,this.httpETag)}get isEmpty(){return!this.config}isExpired(e){return this===S.empty||this.timestamp+e<S.generateTimestamp()}static generateTimestamp(){return new Date().getTime()}static serialize(e){var t,i;return e.timestamp+`
`+((t=e.httpETag)!==null&&t!==void 0?t:"")+`
`+((i=e.configJson)!==null&&i!==void 0?i:"")}static deserialize(e){const t=Array(2);let i=0;for(let u=0;u<t.length;u++){if(i=e.indexOf(`
`,i),i<0)throw new Error("Number of values is fewer than expected.");t[u]=i++}let s=t[0],r=e.substring(0,s);const o=parseInt(r);if(isNaN(o))throw new Error("Invalid fetch time: "+r);i=s+1,s=t[1],r=e.substring(i,s);const a=r.length>0?r:void 0;i=s+1,r=e.substring(i);let l,c;return r.length>0&&(l=_.deserialize(r),c=r),new S(c,l,o,a)}}S.serializationFormatVersion="v2",S.empty=new S(void 0,void 0,0,void 0);class _{static deserialize(e){const t=JSON.parse(e);if(typeof t!="object"||!t)throw new Error("Invalid config JSON content:"+e);return new _(t)}constructor(e){var t,i;this.preferences=e.p!=null?new mt(e.p):void 0,this.segments=(i=(t=e.s)===null||t===void 0?void 0:t.map(s=>new Et(s)))!==null&&i!==void 0?i:[],this.settings=e.f!=null?Object.entries(e.f).reduce((s,[r,o])=>(s[r]=new x(o,this),s),{}):{}}get salt(){var e;return(e=this.preferences)===null||e===void 0?void 0:e.salt}}class mt{constructor(e){this.baseUrl=e.u,this.redirectMode=e.r,this.salt=e.s}}class Et{constructor(e){var t,i;this.name=e.n,this.conditions=(i=(t=e.r)===null||t===void 0?void 0:t.map(s=>new Le(s)))!==null&&i!==void 0?i:[]}}class he{constructor(e,t=!1){this.value=t?e.v:ke(e.v),this.variationId=e.i}}class x extends he{constructor(e,t){var i,s,r,o,a,l;super(e,e.t<0),this.type=e.t;const c="Identifier";this.percentageOptionsAttribute=(i=e.a)!==null&&i!==void 0?i:c,this.targetingRules=(r=(s=e.r)===null||s===void 0?void 0:s.map(u=>new St(u,t)))!==null&&r!==void 0?r:[],this.percentageOptions=(a=(o=e.p)===null||o===void 0?void 0:o.map(u=>new Fe(u)))!==null&&a!==void 0?a:[],this.configJsonSalt=(l=t==null?void 0:t.salt)!==null&&l!==void 0?l:""}static fromValue(e){return new x({t:-1,v:e})}}class St{constructor(e,t){var i,s;this.conditions=(s=(i=e.c)===null||i===void 0?void 0:i.map(r=>r.u!=null?new Le(r.u):r.p!=null?new Ot(r.p):r.s!=null?new At(r.s,t):void 0))!==null&&s!==void 0?s:[],this.then=e.p!=null?e.p.map(r=>new Fe(r)):new he(e.s)}}class Fe extends he{constructor(e){super(e),this.percentage=e.p}}class Le{constructor(e){var t,i;this.type="UserCondition",this.comparisonAttribute=e.a,this.comparator=e.c,this.comparisonValue=(i=(t=e.s)!==null&&t!==void 0?t:e.d)!==null&&i!==void 0?i:e.l}}class Ot{constructor(e){this.type="PrerequisiteFlagCondition",this.prerequisiteFlagKey=e.f,this.comparator=e.c,this.comparisonValue=ke(e.v)}}class At{constructor(e,t){this.type="SegmentCondition",this.segment=t.segments[e.s],this.comparator=e.c}}function ke(n){var e,t,i;return(i=(t=(e=n.b)!==null&&e!==void 0?e:n.s)!==null&&t!==void 0?t:n.i)!==null&&i!==void 0?i:n.d}function wt(n){return h.SettingType[n]}class R{constructor(e,t){this.errorMessage=e,this.errorException=t}get isSuccess(){return this.errorMessage===null}static from(e){return e.status!==2?R.success():R.failure(e.errorMessage,e.errorException)}static success(){return new R(null)}static failure(e,t){return new R(e,t)}}h.ClientCacheState=void 0,function(n){n[n.NoFlagData=0]="NoFlagData",n[n.HasLocalOverrideFlagDataOnly=1]="HasLocalOverrideFlagDataOnly",n[n.HasCachedFlagDataOnly=2]="HasCachedFlagDataOnly",n[n.HasUpToDateFlagData=3]="HasUpToDateFlagData"}(h.ClientCacheState||(h.ClientCacheState={}));var ge;(function(n){n[n.Online=0]="Online",n[n.Offline=1]="Offline",n[n.Disposed=2]="Disposed"})(ge||(ge={}));function De(n){return ge[n]}class fe{constructor(e,t){this.configFetcher=e,this.options=t,this.pendingFetch=null,this.cacheKey=t.getCacheKey(),this.configFetcher=e,this.options=t,this.status=t.offline?1:0}dispose(){this.status=2}get disposed(){return this.status===2}async refreshConfigAsync(){const e=await this.options.cache.get(this.cacheKey);if(this.isOffline){const t=this.options.logger.configServiceCannotInitiateHttpCalls().toString();return[R.failure(t),e]}else{const[t,i]=await this.refreshConfigCoreAsync(e);return[R.from(t),i]}}async refreshConfigCoreAsync(e){const t=await this.fetchAsync(e);let i=!1;const s=t.status===0;return(s||t.config.timestamp>e.timestamp&&(!t.config.isEmpty||e.isEmpty))&&(await this.options.cache.set(this.cacheKey,t.config),i=s&&!S.equals(t.config,e),e=t.config),this.onConfigFetched(t.config),i&&this.onConfigChanged(t.config),[t,e]}onConfigFetched(e){}onConfigChanged(e){var t;this.options.logger.debug("config changed"),this.options.hooks.emit("configChanged",(t=e.config)!==null&&t!==void 0?t:new _({}))}fetchAsync(e){var t;return(t=this.pendingFetch)!==null&&t!==void 0?t:this.pendingFetch=(async()=>{try{return await this.fetchLogicAsync(e)}finally{this.pendingFetch=null}})()}async fetchLogicAsync(e){var t;const i=this.options;i.logger.debug("ConfigServiceBase.fetchLogicAsync() - called.");let s;try{const[r,o]=await this.fetchRequestAsync((t=e.httpETag)!==null&&t!==void 0?t:null);switch(r.statusCode){case 200:return o instanceof _?(i.logger.debug("ConfigServiceBase.fetchLogicAsync(): fetch was successful. Returning new config."),I.success(new S(r.body,o,S.generateTimestamp(),r.eTag))):(s=i.logger.fetchReceived200WithInvalidBody(o).toString(),i.logger.debug(`ConfigServiceBase.fetchLogicAsync(): ${r.statusCode} ${r.reasonPhrase} was received but the HTTP response content was invalid. Returning null.`),I.error(e,s,o));case 304:return e?(i.logger.debug("ConfigServiceBase.fetchLogicAsync(): content was not modified. Returning last config with updated timestamp."),I.notModified(e.with(S.generateTimestamp()))):(s=i.logger.fetchReceived304WhenLocalCacheIsEmpty(r.statusCode,r.reasonPhrase).toString(),i.logger.debug(`ConfigServiceBase.fetchLogicAsync(): ${r.statusCode} ${r.reasonPhrase} was received when no config is cached locally. Returning null.`),I.error(e,s));case 403:case 404:return s=i.logger.fetchFailedDueToInvalidSdkKey().toString(),i.logger.debug("ConfigServiceBase.fetchLogicAsync(): fetch was unsuccessful. Returning last config (if any) with updated timestamp."),I.error(e.with(S.generateTimestamp()),s);default:return s=i.logger.fetchFailedDueToUnexpectedHttpResponse(r.statusCode,r.reasonPhrase).toString(),i.logger.debug("ConfigServiceBase.fetchLogicAsync(): fetch was unsuccessful. Returning null."),I.error(e,s)}}catch(r){return s=(r instanceof N&&r.cause==="timeout"?i.logger.fetchFailedDueToRequestTimeout(r.args[0],r):i.logger.fetchFailedDueToUnexpectedError(r)).toString(),i.logger.debug("ConfigServiceBase.fetchLogicAsync(): fetch was unsuccessful. Returning null."),I.error(e,s,r)}}async fetchRequestAsync(e,t=2){const i=this.options;i.logger.debug("ConfigServiceBase.fetchRequestAsync() - called.");for(let s=0;;s++){i.logger.debug(`ConfigServiceBase.fetchRequestAsync(): calling fetchLogic()${s>0?`, retry ${s}/${t}`:""}`);const r=await this.configFetcher.fetchLogic(i,e);if(r.statusCode!==200)return[r];if(!r.body)return i.logger.debug("ConfigServiceBase.fetchRequestAsync(): no response body."),[r,new Error("No response body.")];let o;try{o=_.deserialize(r.body)}catch(u){return i.logger.debug("ConfigServiceBase.fetchRequestAsync(): invalid response body."),[r,u]}const a=o.preferences;if(!a)return i.logger.debug("ConfigServiceBase.fetchRequestAsync(): preferences is empty."),[r,o];const l=a.baseUrl;if(!l||l===i.baseUrl)return i.logger.debug("ConfigServiceBase.fetchRequestAsync(): baseUrl OK."),[r,o];const c=a.redirectMode;if(i.baseUrlOverriden&&c!==2)return i.logger.debug("ConfigServiceBase.fetchRequestAsync(): options.baseUrlOverriden && redirect !== 2."),[r,o];if(i.baseUrl=l,c===0)return[r,o];if(c===1&&i.logger.dataGovernanceIsOutOfSync(),s>=t)return i.logger.fetchFailedDueToRedirectLoop(),[r,o]}}get isOfflineExactly(){return this.status===1}get isOffline(){return this.status!==0}setOnlineCore(){}setOnline(){this.status===1?(this.setOnlineCore(),this.status=0,this.options.logger.configServiceStatusChanged(De(this.status))):this.disposed&&this.options.logger.configServiceMethodHasNoEffectDueToDisposedClient("setOnline")}setOfflineCore(){}setOffline(){this.status===0?(this.setOfflineCore(),this.status=1,this.options.logger.configServiceStatusChanged(De(this.status))):this.disposed&&this.options.logger.configServiceMethodHasNoEffectDueToDisposedClient("setOffline")}syncUpWithCache(){return this.options.cache.get(this.cacheKey)}async getReadyPromise(e,t){const i=await t(e);return this.options.hooks.emit("clientReady",i),i}}class de{constructor(){this.callbacks=[]}get aborted(){return!this.callbacks}abort(){if(!this.aborted){const e=this.callbacks;this.callbacks=null;for(const t of e)t()}}registerCallback(e){return this.aborted?(e(),()=>{}):(this.callbacks.push(e),()=>{const t=this.callbacks;let i;t&&(i=t.indexOf(e))>=0&&t.splice(i,1)})}}function $e(n,e){let t;return new Promise(i=>{const s=e==null?void 0:e.registerCallback(()=>{clearTimeout(t),i(!1)});t=setTimeout(()=>{s==null||s(),i(!0)},n)})}function P(n,e=!1){return n instanceof Error?e&&n.stack?n.stack:n.toString():n+""}function Pe(n){throw n}function V(n){return Array.isArray(n)}function ve(n){return V(n)&&!n.some(e=>typeof e!="string")}function pe(n,e=0,t,i=", "){const s=n.length;if(!s)return"";let r="";return e>0&&s>e&&(n=n.slice(0,e),t&&(r=t(s-e))),"'"+n.join("'"+i+"'")+"'"+r}function Tt(n){return typeof(n==null?void 0:n.then)=="function"}function B(n){function e(o,a){const l=o.charCodeAt(a);if(55296<=l&&l<56320){const c=o.charCodeAt(a+1);if(56320<=c&&c<=57343)return(l<<10)+c-56613888}return l}let t="",i=0;const s=String.fromCharCode;let r;for(r=0;r<n.length;r++){const o=e(n,r);o<=127||(t+=n.slice(i,r),o<=2047?(t+=s(192|o>>6),t+=s(128|o&63)):o<=65535?(t+=s(224|o>>12),t+=s(128|o>>6&63),t+=s(128|o&63)):(t+=s(240|o>>18),t+=s(128|o>>12&63),t+=s(128|o>>6&63),t+=s(128|o&63),++r),i=r+1)}return t+=n.slice(i,r)}function ye(n){return typeof n=="number"?n:typeof n!="string"||!n.length||/^\s*$|^\s*0[^\d.e]/.test(n)?NaN:+n}const It=500;class Ct extends fe{constructor(e,t){super(e,t),this.signalInitialization=()=>{},this.stopToken=new de,this.pollIntervalMs=t.pollIntervalSeconds*1e3,this.pollExpirationMs=this.pollIntervalMs-It;const i=this.syncUpWithCache();if(t.maxInitWaitTimeSeconds!==0){this.initialized=!1;const s=new Promise(r=>this.signalInitialization=r);this.initializationPromise=this.waitForInitializationAsync(s).then(r=>(this.initialized=!0,r))}else this.initialized=!0,this.initializationPromise=Promise.resolve(!1);this.readyPromise=this.getReadyPromise(this.initializationPromise,async s=>(await s,this.getCacheState(this.options.cache.getInMemory()))),t.offline||this.startRefreshWorker(i,this.stopToken)}async waitForInitializationAsync(e){if(this.options.maxInitWaitTimeSeconds<0)return await e,!0;const t=new de,i=await Promise.race([e.then(()=>!0),$e(this.options.maxInitWaitTimeSeconds*1e3,t).then(()=>!1)]);return t.abort(),i}async getConfig(){this.options.logger.debug("AutoPollConfigService.getConfig() called.");function e(i){i.debug("AutoPollConfigService.getConfig() - returning value from cache.")}let t;if(!this.isOffline&&!this.initialized){if(t=await this.options.cache.get(this.cacheKey),!t.isExpired(this.pollIntervalMs))return e(this.options.logger),t;this.options.logger.debug("AutoPollConfigService.getConfig() - cache is empty or expired, waiting for initialization."),await this.initializationPromise}return t=await this.options.cache.get(this.cacheKey),t.isExpired(this.pollIntervalMs)?this.options.logger.debug("AutoPollConfigService.getConfig() - cache is empty or expired."):e(this.options.logger),t}refreshConfigAsync(){return this.options.logger.debug("AutoPollConfigService.refreshConfigAsync() called."),super.refreshConfigAsync()}dispose(){this.options.logger.debug("AutoPollConfigService.dispose() called."),super.dispose(),this.stopToken.aborted||this.stopRefreshWorker()}onConfigFetched(e){super.onConfigFetched(e),this.signalInitialization()}setOnlineCore(){this.startRefreshWorker(null,this.stopToken)}setOfflineCore(){this.stopRefreshWorker(),this.stopToken=new de}async startRefreshWorker(e,t){this.options.logger.debug("AutoPollConfigService.startRefreshWorker() called.");let i=!0;for(;!t.aborted;){try{const s=new Date().getTime()+this.pollIntervalMs;try{await this.refreshWorkerLogic(i,e)}catch(o){this.options.logger.autoPollConfigServiceErrorDuringPolling(o)}const r=s-new Date().getTime();r>0&&await $e(r,t)}catch(s){this.options.logger.autoPollConfigServiceErrorDuringPolling(s)}i=!1,e=null}}stopRefreshWorker(){this.options.logger.debug("AutoPollConfigService.stopRefreshWorker() called."),this.stopToken.abort()}async refreshWorkerLogic(e,t){this.options.logger.debug("AutoPollConfigService.refreshWorkerLogic() - called.");const i=await(t??this.options.cache.get(this.cacheKey));i.isExpired(this.pollExpirationMs)?(e?!this.isOfflineExactly:!this.isOffline)&&await this.refreshConfigCoreAsync(i):e&&this.signalInitialization()}getCacheState(e){return e.isEmpty?0:e.isExpired(this.pollIntervalMs)?2:3}}class Me{constructor(){this.cachedConfig=S.empty}set(e,t){this.cachedConfig=t}get(e){return this.cachedConfig}getInMemory(){return this.cachedConfig}}class me{constructor(e,t){this.cache=e,this.logger=t,this.cachedConfig=S.empty}async set(e,t){try{if(!t.isEmpty)this.cachedSerializedConfig=S.serialize(t),this.cachedConfig=t;else{this.cachedSerializedConfig=void 0,this.cachedConfig=t;return}await this.cache.set(e,this.cachedSerializedConfig)}catch(i){this.logger.configServiceCacheWriteError(i)}}updateCachedConfig(e){e==null||e===this.cachedSerializedConfig||(this.cachedConfig=S.deserialize(e),this.cachedSerializedConfig=e)}get(e){try{const t=this.cache.get(e);if(Tt(t))return(async i=>{try{this.updateCachedConfig(await i)}catch(s){this.logger.configServiceCacheReadError(s)}return this.cachedConfig})(t);this.updateCachedConfig(t)}catch(t){this.logger.configServiceCacheReadError(t)}return Promise.resolve(this.cachedConfig)}getInMemory(){return this.cachedConfig}}h.LogLevel=void 0,function(n){n[n.Debug=4]="Debug",n[n.Info=3]="Info",n[n.Warn=2]="Warn",n[n.Error=1]="Error",n[n.Off=-1]="Off"}(h.LogLevel||(h.LogLevel={}));function bt(n){return h.LogLevel[n]}class m{static from(...e){return(t,...i)=>new m(t,e,i)}constructor(e,t,i){this.strings=e,this.argNames=t,this.argValues=i}get defaultFormattedMessage(){let e=this.cachedDefaultFormattedMessage;if(e===void 0){e="";const{strings:t,argValues:i}=this;let s=0;for(;s<t.length-1;s++)e+=t[s],e+=i[s];e+=t[s],this.cachedDefaultFormattedMessage=e}return e}toString(){return this.defaultFormattedMessage}}class Nt{get level(){var e;return(e=this.logger.level)!==null&&e!==void 0?e:2}get eol(){var e;return(e=this.logger.eol)!==null&&e!==void 0?e:`
`}constructor(e,t){this.logger=e,this.hooks=t}isEnabled(e){return this.level>=e}log(e,t,i,s){var r;return this.isEnabled(e)&&this.logger.log(e,t,i,s),e===1&&((r=this.hooks)===null||r===void 0||r.emit("clientError",i.toString(),s)),i}debug(e){this.log(4,0,e)}configJsonIsNotPresent(e){return this.log(1,1e3,m.from("DEFAULT_RETURN_VALUE")`Config JSON is not present. Returning ${e}.`)}configJsonIsNotPresentSingle(e,t,i){return this.log(1,1e3,m.from("KEY","DEFAULT_PARAM_NAME","DEFAULT_PARAM_VALUE")`Config JSON is not present when evaluating setting '${e}'. Returning the \`${t}\` parameter that you specified in your application: '${i}'.`)}settingEvaluationFailedDueToMissingKey(e,t,i,s){return this.log(1,1001,m.from("KEY","DEFAULT_PARAM_NAME","DEFAULT_PARAM_VALUE","AVAILABLE_KEYS")`Failed to evaluate setting '${e}' (the key was not found in config JSON). Returning the \`${t}\` parameter that you specified in your application: '${i}'. Available keys: [${s}].`)}settingEvaluationError(e,t,i){return this.log(1,1002,m.from("METHOD_NAME","DEFAULT_RETURN_VALUE")`Error occurred in the \`${e}\` method. Returning ${t}.`,i)}settingEvaluationErrorSingle(e,t,i,s,r){return this.log(1,1002,m.from("METHOD_NAME","KEY","DEFAULT_PARAM_NAME","DEFAULT_PARAM_VALUE")`Error occurred in the \`${e}\` method while evaluating setting '${t}'. Returning the \`${i}\` parameter that you specified in your application: '${s}'.`,r)}forceRefreshError(e,t){return this.log(1,1003,m.from("METHOD_NAME")`Error occurred in the \`${e}\` method.`,t)}fetchFailedDueToInvalidSdkKey(){return this.log(1,1100,"Your SDK Key seems to be wrong. You can find the valid SDK Key at https://app.configcat.com/sdkkey")}fetchFailedDueToUnexpectedHttpResponse(e,t){return this.log(1,1101,m.from("STATUS_CODE","REASON_PHRASE")`Unexpected HTTP response was received while trying to fetch config JSON: ${e} ${t}`)}fetchFailedDueToRequestTimeout(e,t){return this.log(1,1102,m.from("TIMEOUT")`Request timed out while trying to fetch config JSON. Timeout value: ${e}ms`,t)}fetchFailedDueToUnexpectedError(e){return this.log(1,1103,"Unexpected error occurred while trying to fetch config JSON. It is most likely due to a local network issue. Please make sure your application can reach the ConfigCat CDN servers (or your proxy server) over HTTP.",e)}fetchFailedDueToRedirectLoop(){return this.log(1,1104,"Redirection loop encountered while trying to fetch config JSON. Please contact us at https://configcat.com/support/")}fetchReceived200WithInvalidBody(e){return this.log(1,1105,"Fetching config JSON was successful but the HTTP response content was invalid.",e)}fetchReceived304WhenLocalCacheIsEmpty(e,t){return this.log(1,1106,m.from("STATUS_CODE","REASON_PHRASE")`Unexpected HTTP response was received when no config JSON is cached locally: ${e} ${t}`)}autoPollConfigServiceErrorDuringPolling(e){return this.log(1,1200,"Error occurred during auto polling.",e)}settingForVariationIdIsNotPresent(e){return this.log(1,2011,m.from("VARIATION_ID")`Could not find the setting for the specified variation ID: '${e}'.`)}configServiceCacheReadError(e){return this.log(1,2200,"Error occurred while reading the cache.",e)}configServiceCacheWriteError(e){return this.log(1,2201,"Error occurred while writing the cache.",e)}clientIsAlreadyCreated(e){return this.log(2,3e3,m.from("SDK_KEY")`There is an existing client instance for the specified SDK Key. No new client instance will be created and the specified options are ignored. Returning the existing client instance. SDK Key: '${e}'.`)}userObjectIsMissing(e){return this.log(2,3001,m.from("KEY")`Cannot evaluate targeting rules and % options for setting '${e}' (User Object is missing). You should pass a User Object to the evaluation methods like \`getValueAsync()\` in order to make targeting work properly. Read more: https://configcat.com/docs/advanced/user-object/`)}dataGovernanceIsOutOfSync(){return this.log(2,3002,"The `dataGovernance` parameter specified at the client initialization is not in sync with the preferences on the ConfigCat Dashboard. Read more: https://configcat.com/docs/advanced/data-governance/")}userObjectAttributeIsMissingPercentage(e,t){return this.log(2,3003,m.from("KEY","ATTRIBUTE_NAME","ATTRIBUTE_NAME")`Cannot evaluate % options for setting '${e}' (the User.${t} attribute is missing). You should set the User.${t} attribute in order to make targeting work properly. Read more: https://configcat.com/docs/advanced/user-object/`)}userObjectAttributeIsMissingCondition(e,t,i){return this.log(2,3003,m.from("CONDITION","KEY","ATTRIBUTE_NAME","ATTRIBUTE_NAME")`Cannot evaluate condition (${e}) for setting '${t}' (the User.${i} attribute is missing). You should set the User.${i} attribute in order to make targeting work properly. Read more: https://configcat.com/docs/advanced/user-object/`)}userObjectAttributeIsInvalid(e,t,i,s){return this.log(2,3004,m.from("CONDITION","KEY","REASON","ATTRIBUTE_NAME")`Cannot evaluate condition (${e}) for setting '${t}' (${i}). Please check the User.${s} attribute and make sure that its value corresponds to the comparison operator.`)}userObjectAttributeIsAutoConverted(e,t,i,s){return this.log(2,3005,m.from("CONDITION","KEY","ATTRIBUTE_NAME","ATTRIBUTE_VALUE")`Evaluation of condition (${e}) for setting '${t}' may not produce the expected result (the User.${i} attribute is not a string value, thus it was automatically converted to the string value '${s}'). Please make sure that using a non-string value was intended.`)}configServiceCannotInitiateHttpCalls(){return this.log(2,3200,"Client is in offline mode, it cannot initiate HTTP calls.")}configServiceMethodHasNoEffectDueToDisposedClient(e){return this.log(2,3201,m.from("METHOD_NAME")`The client object is already disposed, thus \`${e}()\` has no effect.`)}configServiceMethodHasNoEffectDueToOverrideBehavior(e,t){return this.log(2,3202,m.from("OVERRIDE_BEHAVIOR","METHOD_NAME")`Client is configured to use the \`${e}\` override behavior, thus \`${t}()\` has no effect.`)}settingEvaluated(e){return this.log(3,5e3,m.from("EVALUATE_LOG")`${e}`)}configServiceStatusChanged(e){return this.log(3,5200,m.from("MODE")`Switched to ${e.toUpperCase()} mode.`)}}class Ue{constructor(e=2,t=`
`){this.level=e,this.eol=t,this.SOURCE="ConfigCat"}log(e,t,i,s){const[r,o]=e===4?[console.info,"DEBUG"]:e===3?[console.info,"INFO"]:e===2?[console.warn,"WARN"]:e===1?[console.error,"ERROR"]:[console.log,bt(e).toUpperCase()],a=s!==void 0?this.eol+P(s,!0):"";r(`${this.SOURCE} - ${o} - [${t}] ${i}${a}`)}}class Ee{constructor(){this.addListener=this.on,this.off=this.removeListener}on(){return this}once(){return this}removeListener(){return this}removeAllListeners(){return this}listeners(){return[]}listenerCount(){return 0}eventNames(){return[]}emit(){return!1}}function _e(n){function e(D,$){var le=D<<$|D>>>32-$;return le}var t,i,s,r=new Array(80),o=1732584193,a=4023233417,l=2562383102,c=271733878,u=3285377520,g,f,d,p,E,w;n=B(n);var O=n.length,b=new Array;for(i=0;i<O-3;i+=4)s=n.charCodeAt(i)<<24|n.charCodeAt(i+1)<<16|n.charCodeAt(i+2)<<8|n.charCodeAt(i+3),b.push(s);switch(O%4){case 0:i=2147483648;break;case 1:i=n.charCodeAt(O-1)<<24|8388608;break;case 2:i=n.charCodeAt(O-2)<<24|n.charCodeAt(O-1)<<16|32768;break;case 3:i=n.charCodeAt(O-3)<<24|n.charCodeAt(O-2)<<16|n.charCodeAt(O-1)<<8|128;break}for(b.push(i);b.length%16!=14;)b.push(0);for(b.push(O>>>29),b.push(O<<3&4294967295),t=0;t<b.length;t+=16){for(i=0;i<16;i++)r[i]=b[t+i];for(i=16;i<=79;i++)r[i]=e(r[i-3]^r[i-8]^r[i-14]^r[i-16],1);for(g=o,f=a,d=l,p=c,E=u,i=0;i<=19;i++)w=e(g,5)+(f&d|~f&p)+E+r[i]+1518500249&4294967295,E=p,p=d,d=e(f,30),f=g,g=w;for(i=20;i<=39;i++)w=e(g,5)+(f^d^p)+E+r[i]+1859775393&4294967295,E=p,p=d,d=e(f,30),f=g,g=w;for(i=40;i<=59;i++)w=e(g,5)+(f&d|f&p|d&p)+E+r[i]+2400959708&4294967295,E=p,p=d,d=e(f,30),f=g,g=w;for(i=60;i<=79;i++)w=e(g,5)+(f^d^p)+E+r[i]+3395469782&4294967295,E=p,p=d,d=e(f,30),f=g,g=w;o=o+g&4294967295,a=a+f&4294967295,l=l+d&4294967295,c=c+p&4294967295,u=u+E&4294967295}return qe([o,a,l,c,u])}function Ve(n){function e(vt,pt){return vt>>>pt|vt<<32-pt}const t="length";var i=Math.pow,s=i(2,32),r,o,a=Ve,l=a.h,c=a.k;if(!c){l=[],c=[];for(var u={},g=2,f=0;f<64;g++)if(!u[g]){for(r=0;r<313;r+=g)u[r]=g;l[f]=i(g,.5)*s|0,c[f++]=i(g,1/3)*s|0}a.h=l=l.slice(0,8),a.k=c}var d=n[t]*8;n+="Â€";for(var p=[];n[t]%64-56;)n+="\0";for(r=0;r<n[t];r++)o=n.charCodeAt(r),p[r>>2]|=o<<(3-r)%4*8;for(p[p[t]]=d/s|0,p[p[t]]=d,o=0;o<p[t];){var E=p.slice(o,o+=16),w=l;for(l=l.slice(0,8),r=0;r<64;r++){var O=E[r-15],b=E[r-2],D=l[0],$=l[4],le=l[7]+(e($,6)^e($,11)^e($,25))+($&l[5]^~$&l[6])+c[r]+(E[r]=r<16?E[r]:E[r-16]+(e(O,7)^e(O,18)^O>>>3)+E[r-7]+(e(b,17)^e(b,19)^b>>>10)|0),fi=(e(D,2)^e(D,13)^e(D,22))+(D&l[1]^D&l[2]^l[1]&l[2]);l=[le+fi|0].concat(l),l[4]=l[4]+le|0}for(r=0;r<8;r++)l[r]=l[r]+w[r]|0}return qe(l,8)}function qe(n,e){const t="0123456789abcdef";var i="";e??(e=n.length);for(let s=0;s<e;s++)for(let r=3;r>=0;r--){const o=n[s]>>(r<<3)&255;i+=t[o>>4],i+=t[o&15]}return i}const xe=new Ee;class Be{constructor(e){this.addListener=this.on,this.off=this.removeListener,this.eventEmitter=e}tryDisconnect(){const e=this.eventEmitter;return this.eventEmitter=xe,e!==xe}on(e,t){return this.eventEmitter.on(e,t),this}once(e,t){return this.eventEmitter.once(e,t),this}removeListener(e,t){return this.eventEmitter.removeListener(e,t),this}removeAllListeners(e){return this.eventEmitter.removeAllListeners(e),this}listeners(e){return this.eventEmitter.listeners(e)}listenerCount(e){return this.eventEmitter.listenerCount(e)}eventNames(){return this.eventEmitter.eventNames()}emit(e,...t){return this.eventEmitter.emit(e,...t)}}function We(){const n=function(e){this.target=e};return n.prototype.deref=function(){return this.target},n.isFallback=!0,n}const Ke=()=>typeof WeakRef=="function";h.PollingMode=void 0,function(n){n[n.AutoPoll=0]="AutoPoll",n[n.LazyLoad=1]="LazyLoad",n[n.ManualPoll=2]="ManualPoll"}(h.PollingMode||(h.PollingMode={})),h.DataGovernance=void 0,function(n){n[n.Global=0]="Global",n[n.EuOnly=1]="EuOnly"}(h.DataGovernance||(h.DataGovernance={}));class M{constructor(e,t,i,s,r){var o,a,l;if(this.requestTimeoutMs=3e4,this.baseUrlOverriden=!1,this.proxy="",this.offline=!1,!e)throw new Error("Invalid 'sdkKey' value");switch(this.sdkKey=e,this.clientVersion=t,this.dataGovernance=(o=i==null?void 0:i.dataGovernance)!==null&&o!==void 0?o:0,this.dataGovernance){case 1:this.baseUrl="https://cdn-eu.configcat.com";break;default:this.baseUrl="https://cdn-global.configcat.com";break}const c=(a=r==null?void 0:r())!==null&&a!==void 0?a:new Ee,u=new Be(c),g=new(Ke()?WeakRef:We())(u);this.hooks={hooks:u,hooksWeakRef:g,emit(p,...E){var w,O;return(O=(w=this.hooksWeakRef.deref())===null||w===void 0?void 0:w.emit(p,...E))!==null&&O!==void 0?O:!1}};let f,d;if(i){if(f=i.logger,d=i.cache,i.requestTimeoutMs){if(i.requestTimeoutMs<0)throw new Error("Invalid 'requestTimeoutMs' value");this.requestTimeoutMs=i.requestTimeoutMs}i.baseUrl&&(this.baseUrl=i.baseUrl,this.baseUrlOverriden=!0),i.proxy&&(this.proxy=i.proxy),i.flagOverrides&&(this.flagOverrides=i.flagOverrides),i.defaultUser&&(this.defaultUser=i.defaultUser),i.offline&&(this.offline=i.offline),(l=i.setupHooks)===null||l===void 0||l.call(i,u)}this.logger=new Nt(f??new Ue,this.hooks),this.cache=d?new me(d,this.logger):s?s(this):new Me}yieldHooks(){const e=this.hooks,t=e.hooks;return delete e.hooks,t??new Be(new Ee)}getUrl(){return this.baseUrl+"/configuration-files/"+this.sdkKey+"/"+M.configFileName+"?sdk="+this.clientVersion}getCacheKey(){return _e(`${this.sdkKey}_${M.configFileName}_${S.serializationFormatVersion}`)}}M.configFileName="config_v6.json";class He extends M{constructor(e,t,i,s,r,o){super(e,t+"/a-"+i,s,r,o),this.pollIntervalSeconds=60,this.maxInitWaitTimeSeconds=5,s&&(s.pollIntervalSeconds!=null&&(this.pollIntervalSeconds=s.pollIntervalSeconds),s.maxInitWaitTimeSeconds!=null&&(this.maxInitWaitTimeSeconds=s.maxInitWaitTimeSeconds));const a=2147483;if(!(typeof this.pollIntervalSeconds=="number"&&1<=this.pollIntervalSeconds&&this.pollIntervalSeconds<=a))throw new Error("Invalid 'pollIntervalSeconds' value");if(!(typeof this.maxInitWaitTimeSeconds=="number"&&this.maxInitWaitTimeSeconds<=a))throw new Error("Invalid 'maxInitWaitTimeSeconds' value")}}class ze extends M{constructor(e,t,i,s,r,o){super(e,t+"/m-"+i,s,r,o)}}class je extends M{constructor(e,t,i,s,r,o){if(super(e,t+"/l-"+i,s,r,o),this.cacheTimeToLiveSeconds=60,s&&s.cacheTimeToLiveSeconds!=null&&(this.cacheTimeToLiveSeconds=s.cacheTimeToLiveSeconds),!(typeof this.cacheTimeToLiveSeconds=="number"&&1<=this.cacheTimeToLiveSeconds&&this.cacheTimeToLiveSeconds<=2147483647))throw new Error("Invalid 'cacheTimeToLiveSeconds' value")}}class Je{constructor(e,t){this.dataSource=e,this.behaviour=t}}h.OverrideBehaviour=void 0,function(n){n[n.LocalOnly=0]="LocalOnly",n[n.LocalOverRemote=1]="LocalOverRemote",n[n.RemoteOverLocal=2]="RemoteOverLocal"}(h.OverrideBehaviour||(h.OverrideBehaviour={}));function Rt(n){return h.OverrideBehaviour[n]}class Ft{constructor(e,t){this.initialSettings=Ge(e),t&&(this.map=e)}getOverrides(){return Promise.resolve(this.getOverridesSync())}getOverridesSync(){return this.map?Ge(this.map):this.initialSettings}}function Ge(n){const e={};for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=x.fromValue(n[t]));return e}const Lt="cc-",Y=";str";class kt{get currentValue(){return window==null?void 0:window.location.search}}let Q;class Dt{constructor(e,t,i){this.watchChanges=e,this.paramPrefix=t??Lt,i??(i=Q??(Q=new kt)),this.queryStringProvider=i;const s=i.currentValue;this.settings=Qe(s,this.paramPrefix),this.queryString=Ye(s)}getOverrides(){return Promise.resolve(this.getOverridesSync())}getOverridesSync(){if(this.watchChanges){const e=this.queryStringProvider.currentValue,t=Ye(e);this.queryString!==t&&(this.settings=Qe(e,this.paramPrefix),this.queryString=t)}return this.settings}}function Ye(n){if(n==null)return"";if(typeof n=="string")return n;let e="",t="?";for(const i in n){if(!Object.prototype.hasOwnProperty.call(n,i))continue;const s=n[i];let r,o;if(!V(s))r=s,o=1;else if(s.length)r=s[0],o=s.length;else continue;for(let a=0;e+=t+encodeURIComponent(i)+"="+encodeURIComponent(r),!(++a>=o);)t="&",r=s[a]}return e}function Qe(n,e){const t={};return typeof n=="string"?Pt(n,e,t):n!=null&&$t(n,e,t),t}function $t(n,e,t){for(const i in n){if(!Object.prototype.hasOwnProperty.call(n,i))continue;const s=n[i];let r,o;if(!V(s))r=s,o=1;else if(s.length)r=s[0],o=s.length;else continue;for(let a=0;Xe(i,r,e,t),!(++a>=o);)r=s[a]}}function Pt(n,e,t){if(!n||n.lastIndexOf("?",0)<0)return;const i=n.substring(1).split("&");for(let s of i){s=s.replace(/\+/g," ");const r=s.indexOf("="),o=decodeURIComponent(r>=0?s.substring(0,r):s),a=r>=0?decodeURIComponent(s.substring(r+1)):"";Xe(o,a,e,t)}}function Xe(n,e,t,i){if(!n||n.length<=t.length||n.lastIndexOf(t,0)<0)return;n=n.substring(t.length),n.length>Y.length&&n.indexOf(Y,n.length-Y.length)>=0?n=n.substring(0,n.length-Y.length):e=Mt(e),i[n]=x.fromValue(e)}function Mt(n){switch(n.toLowerCase()){case"false":return!1;case"true":return!0;default:const e=ye(n);return isNaN(e)?n:e}}class Ut extends fe{constructor(e,t){super(e,t),this.cacheTimeToLiveMs=t.cacheTimeToLiveSeconds*1e3;const i=this.syncUpWithCache();this.readyPromise=this.getReadyPromise(i,async s=>this.getCacheState(await s))}async getConfig(){this.options.logger.debug("LazyLoadConfigService.getConfig() called.");function e(i,s=""){i.debug(`LazyLoadConfigService.getConfig(): cache is empty or expired${s}.`)}let t=await this.options.cache.get(this.cacheKey);return t.isExpired(this.cacheTimeToLiveMs)?(this.isOffline?e(this.options.logger):(e(this.options.logger,", calling refreshConfigCoreAsync()"),[,t]=await this.refreshConfigCoreAsync(t)),t):(this.options.logger.debug("LazyLoadConfigService.getConfig(): cache is valid, returning from cache."),t)}refreshConfigAsync(){return this.options.logger.debug("LazyLoadConfigService.refreshConfigAsync() called."),super.refreshConfigAsync()}getCacheState(e){return e.isEmpty?0:e.isExpired(this.cacheTimeToLiveMs)?2:3}}class _t extends fe{constructor(e,t){super(e,t);const i=this.syncUpWithCache();this.readyPromise=this.getReadyPromise(i,async s=>this.getCacheState(await s))}getCacheState(e){return e.isEmpty?0:2}async getConfig(){return this.options.logger.debug("ManualPollService.getConfig() called."),await this.options.cache.get(this.cacheKey)}refreshConfigAsync(){return this.options.logger.debug("ManualPollService.refreshConfigAsync() called."),super.refreshConfigAsync()}}const Ze="<invalid value>",Se="<invalid name>",Oe="<invalid operator>",et="<invalid reference>",Vt=10;class tt{constructor(e){this.eol=e,this.log="",this.indent=""}resetIndent(){return this.indent="",this}increaseIndent(){return this.indent+="  ",this}decreaseIndent(){return this.indent=this.indent.slice(0,-2),this}newLine(e){return this.log+=this.eol+this.indent+(e??""),this}append(e){return this.log+=e,this}toString(){return this.log}appendUserConditionCore(e,t,i){return this.append(`User.${e} ${Ae(t)} '${i??Ze}'`)}appendUserConditionString(e,t,i,s){return typeof i!="string"?this.appendUserConditionCore(e,t):this.appendUserConditionCore(e,t,s?"<hashed value>":i)}appendUserConditionStringList(e,t,i,s){if(!ve(i))return this.appendUserConditionCore(e,t);const r="value",o="values",a=Ae(t);if(s)return this.append(`User.${e} ${a} [<${i.length} hashed ${i.length===1?r:o}>]`);{const l=pe(i,Vt,c=>`, ... <${c} more ${c===1?r:o}>`);return this.append(`User.${e} ${a} [${l}]`)}}appendUserConditionNumber(e,t,i,s){if(typeof i!="number")return this.appendUserConditionCore(e,t);const r=Ae(t);let o;return s&&!isNaN(o=new Date(i*1e3))?this.append(`User.${e} ${r} '${i}' (${o.toISOString()} UTC)`):this.append(`User.${e} ${r} '${i}'`)}appendUserCondition(e){const t=typeof e.comparisonAttribute=="string"?e.comparisonAttribute:Se,i=e.comparator;switch(e.comparator){case 0:case 1:case 2:case 3:case 4:case 5:case 30:case 31:case 32:case 33:case 34:case 35:return this.appendUserConditionStringList(t,i,e.comparisonValue,!1);case 6:case 7:case 8:case 9:case 28:case 29:return this.appendUserConditionString(t,i,e.comparisonValue,!1);case 10:case 11:case 12:case 13:case 14:case 15:return this.appendUserConditionNumber(t,i,e.comparisonValue);case 16:case 17:case 22:case 23:case 24:case 25:case 26:case 27:return this.appendUserConditionStringList(t,i,e.comparisonValue,!0);case 18:case 19:return this.appendUserConditionNumber(t,i,e.comparisonValue,!0);case 20:case 21:return this.appendUserConditionString(t,i,e.comparisonValue,!0);default:return this.appendUserConditionCore(t,i,e.comparisonValue)}}appendPrerequisiteFlagCondition(e,t){const i=typeof e.prerequisiteFlagKey!="string"?Se:e.prerequisiteFlagKey in t?e.prerequisiteFlagKey:et,s=e.comparator,r=e.comparisonValue;return this.append(`Flag '${i}' ${qt(s)} '${X(r)}'`)}appendSegmentCondition(e){const t=e.segment,i=e.comparator,s=t==null?et:typeof t.name!="string"||!t.name?Se:t.name;return this.append(`User ${it(i)} '${s}'`)}appendConditionResult(e){return this.append(`${e}`)}appendConditionConsequence(e){return this.append(" => ").appendConditionResult(e),e?this:this.append(", skipping the remaining AND conditions")}appendTargetingRuleThenPart(e,t){(t?this.newLine():this.append(" ")).append("THEN");const i=e.then;return this.append(V(i)?" % options":` '${X(i.value)}'`)}appendTargetingRuleConsequence(e,t,i){return this.increaseIndent(),this.appendTargetingRuleThenPart(e,i).append(" => ").append(t===!0?"MATCH, applying rule":t===!1?"no match":t),this.decreaseIndent()}}function Ae(n){switch(n){case 0:case 16:case 4:return"IS ONE OF";case 1:case 17:case 5:return"IS NOT ONE OF";case 2:return"CONTAINS ANY OF";case 3:return"NOT CONTAINS ANY OF";case 6:case 12:return"<";case 7:case 13:return"<=";case 8:case 14:return">";case 9:case 15:return">=";case 10:return"=";case 11:return"!=";case 18:return"BEFORE";case 19:return"AFTER";case 28:case 20:return"EQUALS";case 29:case 21:return"NOT EQUALS";case 30:case 22:return"STARTS WITH ANY OF";case 31:case 23:return"NOT STARTS WITH ANY OF";case 32:case 24:return"ENDS WITH ANY OF";case 33:case 25:return"NOT ENDS WITH ANY OF";case 34:case 26:return"ARRAY CONTAINS ANY OF";case 35:case 27:return"ARRAY NOT CONTAINS ANY OF";default:return Oe}}function we(n){return new tt("").appendUserCondition(n).toString()}function qt(n){switch(n){case 0:return"EQUALS";case 1:return"NOT EQUALS";default:return Oe}}function it(n){switch(n){case 0:return"IS IN SEGMENT";case 1:return"IS NOT IN SEGMENT";default:return Oe}}function X(n){return j(n)?n.toString():Ze}const nt=/^[0-9]+$/,W=(n,e)=>{const t=nt.test(n),i=nt.test(e);return t&&i&&(n=+n,e=+e),n===e?0:t&&!i?-1:i&&!t?1:n<e?-1:1},Te=256,Z=Number.MAX_SAFE_INTEGER||9007199254740991,K=[],y=[],v={};let xt=0;const A=(n,e)=>{const t=xt++;v[n]=t,y[t]=e,K[t]=new RegExp(e)};A("NUMERICIDENTIFIER","0|[1-9]\\d*"),A("NUMERICIDENTIFIERLOOSE","[0-9]+"),A("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),A("MAINVERSION",`(${y[v.NUMERICIDENTIFIER]})\\.(${y[v.NUMERICIDENTIFIER]})\\.(${y[v.NUMERICIDENTIFIER]})`),A("MAINVERSIONLOOSE",`(${y[v.NUMERICIDENTIFIERLOOSE]})\\.(${y[v.NUMERICIDENTIFIERLOOSE]})\\.(${y[v.NUMERICIDENTIFIERLOOSE]})`),A("PRERELEASEIDENTIFIER",`(?:${y[v.NUMERICIDENTIFIER]}|${y[v.NONNUMERICIDENTIFIER]})`),A("PRERELEASEIDENTIFIERLOOSE",`(?:${y[v.NUMERICIDENTIFIERLOOSE]}|${y[v.NONNUMERICIDENTIFIER]})`),A("PRERELEASE",`(?:-(${y[v.PRERELEASEIDENTIFIER]}(?:\\.${y[v.PRERELEASEIDENTIFIER]})*))`),A("PRERELEASELOOSE",`(?:-?(${y[v.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${y[v.PRERELEASEIDENTIFIERLOOSE]})*))`),A("BUILDIDENTIFIER","[0-9A-Za-z-]+"),A("BUILD",`(?:\\+(${y[v.BUILDIDENTIFIER]}(?:\\.${y[v.BUILDIDENTIFIER]})*))`),A("FULLPLAIN",`v?${y[v.MAINVERSION]}${y[v.PRERELEASE]}?${y[v.BUILD]}?`),A("FULL",`^${y[v.FULLPLAIN]}$`),A("LOOSEPLAIN",`[v=\\s]*${y[v.MAINVERSIONLOOSE]}${y[v.PRERELEASELOOSE]}?${y[v.BUILD]}?`),A("LOOSE",`^${y[v.LOOSEPLAIN]}$`);class C{constructor(e,t){if((!t||typeof t!="object")&&(t={loose:!!t,includePrerelease:!1}),e instanceof C){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid Version: ${e}`);if(e.length>Te)throw new TypeError(`version is longer than ${Te} characters`);this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const i=e.trim().match(t.loose?K[v.LOOSE]:K[v.FULL]);if(!i)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+i[1],this.minor=+i[2],this.patch=+i[3],this.major>Z||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Z||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Z||this.patch<0)throw new TypeError("Invalid patch version");i[4]?this.prerelease=i[4].split(".").map(s=>{if(/^[0-9]+$/.test(s)){const r=+s;if(r>=0&&r<Z)return r}return s}):this.prerelease=[],this.build=i[5]?i[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(!(e instanceof C)){if(typeof e=="string"&&e===this.version)return 0;e=new C(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof C||(e=new C(e,this.options)),W(this.major,e.major)||W(this.minor,e.minor)||W(this.patch,e.patch)}comparePre(e){if(e instanceof C||(e=new C(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{const i=this.prerelease[t],s=e.prerelease[t];if(i===void 0&&s===void 0)return 0;if(s===void 0)return 1;if(i===void 0)return-1;if(i===s)continue;return W(i,s)}while(++t)}compareBuild(e){e instanceof C||(e=new C(e,this.options));let t=0;do{const i=this.build[t],s=e.build[t];if(i===void 0&&s===void 0)return 0;if(s===void 0)return 1;if(i===void 0)return-1;if(i===s)continue;return W(i,s)}while(++t)}inc(e,t){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t),this.inc("pre",t);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",t),this.inc("pre",t);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":if(this.prerelease.length===0)this.prerelease=[0];else{let i=this.prerelease.length;for(;--i>=0;)typeof this.prerelease[i]=="number"&&(this.prerelease[i]++,i=-2);i===-1&&this.prerelease.push(0)}t&&(this.prerelease[0]===t?isNaN(this.prerelease[1])&&(this.prerelease=[t,0]):this.prerelease=[t,0]);break;default:throw new Error(`invalid increment argument: ${e}`)}return this.format(),this.raw=this.version,this}}const Ie=(n,e)=>{if((!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1}),n instanceof C)return n;if(typeof n!="string"||n.length>Te||!(e.loose?K[v.LOOSE]:K[v.FULL]).test(n))return null;try{return new C(n,e)}catch{return null}};class Bt{constructor(e,t,i,s={}){this.identifier=e,this.email=t,this.country=i,this.custom=s}}function st(n,e){var t,i;switch(e){case"Identifier":return(t=n.identifier)!==null&&t!==void 0?t:"";case"Email":return n.email;case"Country":return n.country;default:return(i=n.custom)===null||i===void 0?void 0:i[e]}}function Wt(n){var e;const t={},i="Identifier",s="Email",r="Country";if(t[i]=(e=n.identifier)!==null&&e!==void 0?e:"",n.email!=null&&(t[s]=n.email),n.country!=null&&(t[r]=n.country),n.custom!=null){const o=[i,s,r];for(const[a,l]of Object.entries(n.custom))l!=null&&o.indexOf(a)<0&&(t[a]=l)}return t}class H{get visitedFlags(){var e;return(e=this.$visitedFlags)!==null&&e!==void 0?e:this.$visitedFlags=[]}constructor(e,t,i,s){this.key=e,this.setting=t,this.user=i,this.settings=s}static forPrerequisiteFlag(e,t,i){const s=new H(e,t,i.user,i.settings);return s.$visitedFlags=i.visitedFlags,s.logBuilder=i.logBuilder,s}}const rt="The current targeting rule is ignored and the evaluation continues with the next rule.",Ce="cannot evaluate, User Object is missing",Kt=n=>`cannot evaluate, the User.${n} attribute is missing`,Ht=(n,e)=>`cannot evaluate, the User.${n} attribute is invalid (${e})`;class zt{constructor(e){this.logger=e}evaluate(e,t){this.logger.debug("RolloutEvaluator.evaluate() called.");let i=t.logBuilder;this.logger.isEnabled(3)&&(t.logBuilder=i=new tt(this.logger.eol),i.append(`Evaluating '${t.key}'`),t.user&&i.append(` for User '${JSON.stringify(Wt(t.user))}'`),i.increaseIndent());let s;try{let r,o;if(e!=null){const a=t.setting.type;if(a>=0&&!Gt(e,a)){const l=wt(a);throw new TypeError(`The type of a setting must match the type of the specified default value. Setting's type was ${l} but the default value's type was ${typeof e}. Please use a default value which corresponds to the setting type ${l}. Learn more: https://configcat.com/docs/sdk-reference/js/#setting-type-mapping`)}r=this.evaluateSetting(t),s=r.selectedValue.value,o=typeof s==typeof e}else r=this.evaluateSetting(t),s=r.selectedValue.value,o=j(s);return o||Re(s),r}catch(r){throw i==null||i.resetIndent().increaseIndent(),s=e,r}finally{i&&(i.newLine(`Returning '${s}'.`).decreaseIndent(),this.logger.settingEvaluated(i.toString()))}}evaluateSetting(e){let t;const i=e.setting.targetingRules;if(i.length>0&&(t=this.evaluateTargetingRules(i,e)))return t;const s=e.setting.percentageOptions;return s.length>0&&(t=this.evaluatePercentageOptions(s,void 0,e))?t:{selectedValue:e.setting}}evaluateTargetingRules(e,t){const i=t.logBuilder;i==null||i.newLine("Evaluating targeting rules and applying the first match if any:");for(let s=0;s<e.length;s++){const r=e[s],o=r.conditions,a=this.evaluateConditions(o,r,t.key,t);if(a!==!0){z(a)&&(i==null||i.increaseIndent().newLine(rt).decreaseIndent());continue}if(!V(r.then))return{selectedValue:r.then,matchedTargetingRule:r};const l=r.then;i==null||i.increaseIndent();const c=this.evaluatePercentageOptions(l,r,t);if(c)return i==null||i.decreaseIndent(),c;i==null||i.newLine(rt).decreaseIndent()}}evaluatePercentageOptions(e,t,i){var s;const r=i.logBuilder;if(!i.user){r==null||r.newLine("Skipping % options because the User Object is missing."),i.isMissingUserObjectLogged||(this.logger.userObjectIsMissing(i.key),i.isMissingUserObjectLogged=!0);return}let o=i.setting.percentageOptionsAttribute,a;if(o==null?(o="Identifier",a=(s=i.user.identifier)!==null&&s!==void 0?s:""):a=st(i.user,o),a==null){r==null||r.newLine(`Skipping % options because the User.${o} attribute is missing.`),i.isMissingUserObjectAttributeLogged||(this.logger.userObjectAttributeIsMissingPercentage(i.key,o),i.isMissingUserObjectAttributeLogged=!0);return}r==null||r.newLine(`Evaluating % options based on the User.${o} attribute:`);const l=_e(i.key+at(a)),c=parseInt(l.substring(0,7),16)%100;r==null||r.newLine(`- Computing hash in the [0..99] range from User.${o} => ${c} (this value is sticky and consistent across all SDKs)`);let u=0;for(let g=0;g<e.length;g++){const f=e[g];if(u+=f.percentage,!(c>=u))return r==null||r.newLine(`- Hash value ${c} selects % option ${g+1} (${f.percentage}%), '${X(f.value)}'.`),{selectedValue:f,matchedTargetingRule:t,matchedPercentageOption:f}}throw new Error("Sum of percentage option percentages is less than 100.")}evaluateConditions(e,t,i,s){let r=!0;const o=s.logBuilder;let a=!1;o==null||o.newLine("- ");for(let l=0;l<e.length;l++){const c=e[l];switch(o&&(l?o.increaseIndent().newLine("AND "):o.append("IF ").increaseIndent()),c.type){case"UserCondition":r=this.evaluateUserCondition(c,i,s),a=e.length>1;break;case"PrerequisiteFlagCondition":r=this.evaluatePrerequisiteFlagCondition(c,s),a=!0;break;case"SegmentCondition":r=this.evaluateSegmentCondition(c,s),a=!z(r)||r!==Ce||e.length>1;break;default:throw new Error}const u=r===!0;if(o&&((!t||e.length>1)&&o.appendConditionConsequence(u),o.decreaseIndent()),!u)break}return t&&(o==null||o.appendTargetingRuleConsequence(t,r,a)),r}evaluateUserCondition(e,t,i){const s=i.logBuilder;if(s==null||s.appendUserCondition(e),!i.user)return i.isMissingUserObjectLogged||(this.logger.userObjectIsMissing(i.key),i.isMissingUserObjectLogged=!0),Ce;const r=e.comparisonAttribute,o=st(i.user,r);if(o==null||o==="")return this.logger.userObjectAttributeIsMissingCondition(we(e),i.key,r),Kt(r);let a,l,c,u;switch(e.comparator){case 28:case 29:return a=F(r,o,e,i.key,this.logger),this.evaluateTextEquals(a,e.comparisonValue,e.comparator===29);case 20:case 21:return a=F(r,o,e,i.key,this.logger),this.evaluateSensitiveTextEquals(a,e.comparisonValue,i.setting.configJsonSalt,t,e.comparator===21);case 0:case 1:return a=F(r,o,e,i.key,this.logger),this.evaluateTextIsOneOf(a,e.comparisonValue,e.comparator===1);case 16:case 17:return a=F(r,o,e,i.key,this.logger),this.evaluateSensitiveTextIsOneOf(a,e.comparisonValue,i.setting.configJsonSalt,t,e.comparator===17);case 30:case 31:return a=F(r,o,e,i.key,this.logger),this.evaluateTextSliceEqualsAnyOf(a,e.comparisonValue,!0,e.comparator===31);case 22:case 23:return a=F(r,o,e,i.key,this.logger),this.evaluateSensitiveTextSliceEqualsAnyOf(a,e.comparisonValue,i.setting.configJsonSalt,t,!0,e.comparator===23);case 32:case 33:return a=F(r,o,e,i.key,this.logger),this.evaluateTextSliceEqualsAnyOf(a,e.comparisonValue,!1,e.comparator===33);case 24:case 25:return a=F(r,o,e,i.key,this.logger),this.evaluateSensitiveTextSliceEqualsAnyOf(a,e.comparisonValue,i.setting.configJsonSalt,t,!1,e.comparator===25);case 2:case 3:return a=F(r,o,e,i.key,this.logger),this.evaluateTextContainsAnyOf(a,e.comparisonValue,e.comparator===3);case 4:case 5:return l=lt(r,o,e,i.key,this.logger),typeof l!="string"?this.evaluateSemVerIsOneOf(l,e.comparisonValue,e.comparator===5):l;case 6:case 7:case 8:case 9:return l=lt(r,o,e,i.key,this.logger),typeof l!="string"?this.evaluateSemVerRelation(l,e.comparator,e.comparisonValue):l;case 10:case 11:case 12:case 13:case 14:case 15:return c=jt(r,o,e,i.key,this.logger),typeof c!="string"?this.evaluateNumberRelation(c,e.comparator,e.comparisonValue):c;case 18:case 19:return c=Jt(r,o,e,i.key,this.logger),typeof c!="string"?this.evaluateDateTimeRelation(c,e.comparisonValue,e.comparator===18):c;case 34:case 35:return u=ct(r,o,e,i.key,this.logger),typeof u!="string"?this.evaluateArrayContainsAnyOf(u,e.comparisonValue,e.comparator===35):u;case 26:case 27:return u=ct(r,o,e,i.key,this.logger),typeof u!="string"?this.evaluateSensitiveArrayContainsAnyOf(u,e.comparisonValue,i.setting.configJsonSalt,t,e.comparator===27):u;default:throw new Error}}evaluateTextEquals(e,t,i){return e===t!==i}evaluateSensitiveTextEquals(e,t,i,s,r){return be(e,i,s)===t!==r}evaluateTextIsOneOf(e,t,i){return t.indexOf(e)>=0!==i}evaluateSensitiveTextIsOneOf(e,t,i,s,r){const o=be(e,i,s);return t.indexOf(o)>=0!==r}evaluateTextSliceEqualsAnyOf(e,t,i,s){for(let r=0;r<t.length;r++){const o=t[r];if(e.length<o.length)continue;if((i?e.lastIndexOf(o,0):e.indexOf(o,e.length-o.length))>=0)return!s}return s}evaluateSensitiveTextSliceEqualsAnyOf(e,t,i,s,r,o){const a=B(e);for(let l=0;l<t.length;l++){const c=t[l],u=c.indexOf("_"),g=parseInt(c.slice(0,u));if(a.length<g)continue;const f=r?a.slice(0,g):a.slice(a.length-g);if(ot(f,i,s)===c.slice(u+1))return!o}return o}evaluateTextContainsAnyOf(e,t,i){for(let s=0;s<t.length;s++)if(e.indexOf(t[s])>=0)return!i;return i}evaluateSemVerIsOneOf(e,t,i){let s=!1;for(let r=0;r<t.length;r++){const o=t[r];if(!o.length)continue;const a=Ie(o.trim());if(!a)return!1;!s&&e.compare(a)===0&&(s=!0)}return s!==i}evaluateSemVerRelation(e,t,i){const s=Ie(i.trim());if(!s)return!1;const r=e.compare(s);switch(t){case 6:return r<0;case 7:return r<=0;case 8:return r>0;case 9:return r>=0}}evaluateNumberRelation(e,t,i){switch(t){case 10:return e===i;case 11:return e!==i;case 12:return e<i;case 13:return e<=i;case 14:return e>i;case 15:return e>=i}}evaluateDateTimeRelation(e,t,i){return i?e<t:e>t}evaluateArrayContainsAnyOf(e,t,i){for(let s=0;s<e.length;s++)if(t.indexOf(e[s])>=0)return!i;return i}evaluateSensitiveArrayContainsAnyOf(e,t,i,s,r){for(let o=0;o<e.length;o++){const a=be(e[o],i,s);if(t.indexOf(a)>=0)return!r}return r}evaluatePrerequisiteFlagCondition(e,t){const i=t.logBuilder;i==null||i.appendPrerequisiteFlagCondition(e,t.settings);const s=e.prerequisiteFlagKey,r=t.settings[s];if(t.visitedFlags.push(t.key),t.visitedFlags.indexOf(s)>=0){t.visitedFlags.push(s);const u=pe(t.visitedFlags,void 0,void 0," -> ");throw new Error(`Circular dependency detected between the following depending flags: ${u}.`)}const o=H.forPrerequisiteFlag(s,r,t);i==null||i.newLine("(").increaseIndent().newLine(`Evaluating prerequisite flag '${s}':`);const a=this.evaluateSetting(o);t.visitedFlags.pop();const l=a.selectedValue.value;if(typeof l!=typeof e.comparisonValue){if(j(l))throw new Error(`Type mismatch between comparison value '${e.comparisonValue}' and prerequisite flag '${s}'.`);Re(l)}let c;switch(e.comparator){case 0:c=l===e.comparisonValue;break;case 1:c=l!==e.comparisonValue;break;default:throw new Error}return i==null||i.newLine(`Prerequisite flag evaluation result: '${X(l)}'.`).newLine("Condition (").appendPrerequisiteFlagCondition(e,t.settings).append(") evaluates to ").appendConditionResult(c).append(".").decreaseIndent().newLine(")"),c}evaluateSegmentCondition(e,t){const i=t.logBuilder;if(i==null||i.appendSegmentCondition(e),!t.user)return t.isMissingUserObjectLogged||(this.logger.userObjectIsMissing(t.key),t.isMissingUserObjectLogged=!0),Ce;const s=e.segment;i==null||i.newLine("(").increaseIndent().newLine(`Evaluating segment '${s.name}':`);const r=this.evaluateConditions(s.conditions,void 0,s.name,t);let o=r;if(!z(o))switch(e.comparator){case 0:break;case 1:o=!o;break;default:throw new Error}return i&&(i.newLine("Segment evaluation result: "),(z(o)?i.append(o):i.append(`User ${it(r?0:1)}`)).append("."),i.newLine("Condition (").appendSegmentCondition(e).append(")"),(z(o)?i.append(" failed to evaluate"):i.append(" evaluates to ").appendConditionResult(o)).append("."),i.decreaseIndent().newLine(")")),o}}function z(n){return typeof n=="string"}function be(n,e,t){return ot(B(n),e,t)}function ot(n,e,t){return Ve(n+B(e)+B(t))}function at(n){return typeof n=="string"?n:n instanceof Date?n.getTime()/1e3+"":ve(n)?JSON.stringify(n):n+""}function F(n,e,t,i,s){return typeof e=="string"||(e=at(e),s.userObjectAttributeIsAutoConverted(we(t),i,n,e)),e}function lt(n,e,t,i,s){let r;return typeof e=="string"&&(r=Ie(e.trim()))?r:ee(s,t,i,n,`'${e}' is not a valid semantic version`)}function jt(n,e,t,i,s){if(typeof e=="number")return e;let r;return typeof e=="string"&&(!isNaN(r=ye(e.replace(",",".")))||e.trim()==="NaN")?r:ee(s,t,i,n,`'${e}' is not a valid decimal number`)}function Jt(n,e,t,i,s){if(e instanceof Date)return e.getTime()/1e3;if(typeof e=="number")return e;let r;return typeof e=="string"&&(!isNaN(r=ye(e.replace(",",".")))||e.trim()==="NaN")?r:ee(s,t,i,n,`'${e}' is not a valid Unix timestamp (number of seconds elapsed since Unix epoch)`)}function ct(n,e,t,i,s){let r=e;if(typeof r=="string")try{r=JSON.parse(r)}catch{}return ve(r)?r:ee(s,t,i,n,`'${e}' is not a valid string array`)}function ee(n,e,t,i,s){return n.userObjectAttributeIsInvalid(we(e),t,s,i),Ht(i,s)}function ut(n,e,t,i){return{key:n,value:e.selectedValue.value,variationId:e.selectedValue.variationId,fetchTime:t,user:i,isDefaultValue:!1,matchedTargetingRule:e.matchedTargetingRule,matchedPercentageOption:e.matchedPercentageOption}}function U(n,e,t,i,s,r){return{key:n,value:e,fetchTime:t,user:i,isDefaultValue:!0,errorMessage:s,errorException:r}}function te(n,e,t,i,s,r,o){let a;if(!e)return a=o.configJsonIsNotPresentSingle(t,"defaultValue",i).toString(),U(t,i,L(r),s,a);const l=e[t];if(!l)return a=o.settingEvaluationFailedDueToMissingKey(t,"defaultValue",i,pe(Object.keys(e))).toString(),U(t,i,L(r),s,a);const c=n.evaluate(i,new H(t,l,s,e));return ut(t,c,L(r),s)}function ht(n,e,t,i,s,r){let o;if(!Ne(e,s,r))return[[],o];const a=[];for(const[l,c]of Object.entries(e)){let u;try{const g=n.evaluate(null,new H(l,c,t,e));u=ut(l,g,L(i),t)}catch(g){o??(o=[]),o.push(g),u=U(l,null,L(i),t,P(g),g)}a.push(u)}return[a,o]}function Ne(n,e,t){return n?!0:(e.configJsonIsNotPresent(t),!1)}function j(n){return typeof n=="boolean"||typeof n=="string"||typeof n=="number"}function Gt(n,e){switch(e){case 0:return typeof n=="boolean";case 1:return typeof n=="string";case 2:case 3:return typeof n=="number";default:return!1}}function Re(n){throw new TypeError(n===null?"Setting value is null.":n===void 0?"Setting value is undefined.":`Setting value '${n}' is of an unsupported type (${typeof n}).`)}function L(n){return n?new Date(n.timestamp):void 0}class Yt{constructor(){this.instances={}}getOrCreate(e,t){let i;const s=this.instances[e.sdkKey];if(s){const[a]=s;if(i=a.deref(),i)return[i,!0]}const r={};i=new k(e,t,r);const o=Ke()?WeakRef:We();return this.instances[e.sdkKey]=[new o(i),r],[i,!1]}remove(e,t){const i=this.instances[e];if(i){const[s,r]=i,o=!!s.deref();if(!o||r===t)return delete this.instances[e],o}return!1}clear(){const e=[];for(const[t,[i]]of Object.entries(this.instances)){const s=i.deref();s&&e.push(s),delete this.instances[t]}return e}}const J=new Yt;class k{static get instanceCache(){return J}static get(e,t,i,s){var r;const o="Invalid 'sdkKey' value";if(!e)throw new Error(o);const a=t===0?He:t===2?ze:t===1?je:Pe(new Error("Invalid 'pollingMode' value")),l=new a(e,s.sdkType,s.sdkVersion,i,s.defaultCacheFactory,s.eventEmitterFactory);if(((r=l.flagOverrides)===null||r===void 0?void 0:r.behaviour)!==0&&!Qt(e,l.baseUrlOverriden))throw new Error(o);const[c,u]=J.getOrCreate(l,s);return u&&i&&l.logger.clientIsAlreadyCreated(e),c}constructor(e,t,i){var s;if(this.cacheToken=i,this.addListener=this.on,this.off=this.removeListener,!e)throw new Error("Invalid 'options' value");if(this.options=e,this.options.logger.debug("Initializing ConfigCatClient. Options: "+JSON.stringify(this.options)),!t)throw new Error("Invalid 'configCatKernel' value");if(!t.configFetcher)throw new Error("Invalid 'configCatKernel.configFetcher' value");this.hooks=e.yieldHooks(),e.defaultUser&&this.setDefaultUser(e.defaultUser),this.evaluator=new zt(e.logger),((s=e.flagOverrides)===null||s===void 0?void 0:s.behaviour)!==0?this.configService=e instanceof He?new Ct(t.configFetcher,e):e instanceof ze?new _t(t.configFetcher,e):e instanceof je?new Ut(t.configFetcher,e):Pe(new Error("Invalid 'options' value")):this.hooks.emit("clientReady",1),this.suppressFinalize=oe(this,{sdkKey:e.sdkKey,cacheToken:i,configService:this.configService,logger:e.logger})}static finalize(e){var t;(t=e.logger)===null||t===void 0||t.debug("finalize() called"),e.cacheToken&&J.remove(e.sdkKey,e.cacheToken),k.close(e.configService,e.logger)}static close(e,t,i){t==null||t.debug("close() called"),i==null||i.tryDisconnect(),e==null||e.dispose()}dispose(){const e=this.options;e.logger.debug("dispose() called"),this.cacheToken&&J.remove(e.sdkKey,this.cacheToken),k.close(this.configService,e.logger,this.hooks),this.suppressFinalize()}static disposeAll(){const e=J.clear();let t;for(const i of e)try{k.close(i.configService,i.options.logger,i.hooks),i.suppressFinalize()}catch(s){t??(t=[]),t.push(s)}if(t)throw typeof AggregateError<"u"?new AggregateError(t):t.pop()}async getValueAsync(e,t,i){this.options.logger.debug("getValueAsync() called."),ne(e),se(t);let s,r,o=null;i??(i=this.defaultUser);try{let a;[a,o]=await this.getSettingsAsync(),r=te(this.evaluator,a,e,t,i,o,this.options.logger),s=r.value}catch(a){this.options.logger.settingEvaluationErrorSingle("getValueAsync",e,"defaultValue",t,a),r=U(e,t,L(o),i,P(a),a),s=t}return this.hooks.emit("flagEvaluated",r),s}async getValueDetailsAsync(e,t,i){this.options.logger.debug("getValueDetailsAsync() called."),ne(e),se(t);let s,r=null;i??(i=this.defaultUser);try{let o;[o,r]=await this.getSettingsAsync(),s=te(this.evaluator,o,e,t,i,r,this.options.logger)}catch(o){this.options.logger.settingEvaluationErrorSingle("getValueDetailsAsync",e,"defaultValue",t,o),s=U(e,t,L(r),i,P(o),o)}return this.hooks.emit("flagEvaluated",s),s}async getAllKeysAsync(){this.options.logger.debug("getAllKeysAsync() called.");const e="empty array";try{const[t]=await this.getSettingsAsync();return Ne(t,this.options.logger,e)?Object.keys(t):[]}catch(t){return this.options.logger.settingEvaluationError("getAllKeysAsync",e,t),[]}}async getAllValuesAsync(e){this.options.logger.debug("getAllValuesAsync() called.");const t="empty array";let i,s,r;e??(e=this.defaultUser);try{const[o,a]=await this.getSettingsAsync();[s,r]=ht(this.evaluator,o,e,a,this.options.logger,t),i=s.map(l=>new q(l.key,l.value))}catch(o){return this.options.logger.settingEvaluationError("getAllValuesAsync",t,o),[]}r!=null&&r.length&&this.options.logger.settingEvaluationError("getAllValuesAsync","evaluation result",typeof AggregateError<"u"?new AggregateError(r):r.pop());for(const o of s)this.hooks.emit("flagEvaluated",o);return i}async getAllValueDetailsAsync(e){this.options.logger.debug("getAllValueDetailsAsync() called.");const t="empty array";let i,s;e??(e=this.defaultUser);try{const[r,o]=await this.getSettingsAsync();[i,s]=ht(this.evaluator,r,e,o,this.options.logger,t)}catch(r){return this.options.logger.settingEvaluationError("getAllValueDetailsAsync",t,r),[]}s!=null&&s.length&&this.options.logger.settingEvaluationError("getAllValueDetailsAsync","evaluation result",typeof AggregateError<"u"?new AggregateError(s):s.pop());for(const r of i)this.hooks.emit("flagEvaluated",r);return i}async getKeyAndValueAsync(e){this.options.logger.debug("getKeyAndValueAsync() called.");const t="null";try{const[i]=await this.getSettingsAsync();if(!Ne(i,this.options.logger,t))return null;for(const[s,r]of Object.entries(i)){if(e===r.variationId)return new q(s,re(r.value));const o=i[s].targetingRules;if(o&&o.length>0)for(let l=0;l<o.length;l++){const c=o[l].then;if(V(c))for(let u=0;u<c.length;u++){const g=c[u];if(e===g.variationId)return new q(s,re(g.value))}else if(e===c.variationId)return new q(s,re(c.value))}const a=i[s].percentageOptions;if(a&&a.length>0)for(let l=0;l<a.length;l++){const c=a[l];if(e===c.variationId)return new q(s,re(c.value))}}this.options.logger.settingForVariationIdIsNotPresent(e)}catch(i){this.options.logger.settingEvaluationError("getKeyAndValueAsync",t,i)}return null}async forceRefreshAsync(){if(this.options.logger.debug("forceRefreshAsync() called."),this.configService)try{const[e]=await this.configService.refreshConfigAsync();return e}catch(e){return this.options.logger.forceRefreshError("forceRefreshAsync",e),R.failure(P(e),e)}else return R.failure("Client is configured to use the LocalOnly override behavior, which prevents making HTTP requests.")}setDefaultUser(e){this.defaultUser=e}clearDefaultUser(){this.defaultUser=void 0}get isOffline(){var e,t;return(t=(e=this.configService)===null||e===void 0?void 0:e.isOffline)!==null&&t!==void 0?t:!0}setOnline(){this.configService?this.configService.setOnline():this.options.logger.configServiceMethodHasNoEffectDueToOverrideBehavior(Rt(0),"setOnline")}setOffline(){var e;(e=this.configService)===null||e===void 0||e.setOffline()}waitForReady(){const e=this.configService;return e?e.readyPromise:Promise.resolve(1)}snapshot(){var e;const t=()=>{const o=this.options.cache.getInMemory();return[o.isEmpty?null:o.config.settings,o]};let i,s;const r=(e=this.options)===null||e===void 0?void 0:e.flagOverrides;if(r){const o=r.dataSource.getOverridesSync();switch(r.behaviour){case 0:return new ie(o,null,this);case 1:return[i,s]=t(),new ie(Object.assign(Object.assign({},i??{}),o),s,this);case 2:return[i,s]=t(),new ie(Object.assign(Object.assign({},o),i??{}),s,this)}}return[i,s]=t(),new ie(i,s,this)}async getSettingsAsync(){var e;this.options.logger.debug("getSettingsAsync() called.");const t=async()=>{const s=await this.configService.getConfig();return[s.isEmpty?null:s.config.settings,s]},i=(e=this.options)===null||e===void 0?void 0:e.flagOverrides;if(i){let s,r;const o=await i.dataSource.getOverrides();switch(i.behaviour){case 0:return[o,null];case 1:return[s,r]=await t(),[Object.assign(Object.assign({},s??{}),o),r];case 2:return[s,r]=await t(),[Object.assign(Object.assign({},o),s??{}),r]}}return await t()}on(e,t){return this.hooks.on(e,t),this}once(e,t){return this.hooks.once(e,t),this}removeListener(e,t){return this.hooks.removeListener(e,t),this}removeAllListeners(e){return this.hooks.removeAllListeners(e),this}listeners(e){return this.hooks.listeners(e)}listenerCount(e){return this.hooks.listenerCount(e)}eventNames(){return this.hooks.eventNames()}}class ie{constructor(e,t,i){this.mergedSettings=e,this.remoteConfig=t,this.defaultUser=i.defaultUser,this.evaluator=i.evaluator,this.options=i.options,this.cacheState=t?i.configService.getCacheState(t):1}get fetchedConfig(){const e=this.remoteConfig;return e&&!e.isEmpty?e.config:null}getAllKeys(){return this.mergedSettings?Object.keys(this.mergedSettings):[]}getValue(e,t,i){this.options.logger.debug("Snapshot.getValue() called."),ne(e),se(t);let s,r;i??(i=this.defaultUser);try{r=te(this.evaluator,this.mergedSettings,e,t,i,this.remoteConfig,this.options.logger),s=r.value}catch(o){this.options.logger.settingEvaluationErrorSingle("Snapshot.getValue",e,"defaultValue",t,o),r=U(e,t,L(this.remoteConfig),i,P(o),o),s=t}return this.options.hooks.emit("flagEvaluated",r),s}getValueDetails(e,t,i){this.options.logger.debug("Snapshot.getValueDetails() called."),ne(e),se(t);let s;i??(i=this.defaultUser);try{s=te(this.evaluator,this.mergedSettings,e,t,i,this.remoteConfig,this.options.logger)}catch(r){this.options.logger.settingEvaluationErrorSingle("Snapshot.getValueDetails",e,"defaultValue",t,r),s=U(e,t,L(this.remoteConfig),i,P(r),r)}return this.options.hooks.emit("flagEvaluated",s),s}}class q{constructor(e,t){this.settingKey=e,this.settingValue=t}}function Qt(n,e){const t="configcat-proxy/";if(e&&n.length>t.length&&n.lastIndexOf(t,0)===0)return!0;const i=n.split("/"),s=22;switch(i.length){case 2:return i[0].length===s&&i[1].length===s;case 3:return i[0]==="configcat-sdk-1"&&i[1].length===s&&i[2].length===s;default:return!1}}function ne(n){if(!n)throw new Error("Invalid 'key' value")}function se(n){if(n!=null&&!j(n))throw new TypeError("The default value must be boolean, number, string, null or undefined.")}function re(n){return j(n)?n:Re(n)}let oe=function(n,e){if(typeof FinalizationRegistry<"u"){const t=new FinalizationRegistry(i=>k.finalize(i));oe=(i,s)=>{const r={};return t.register(i,s,r),()=>t.unregister(r)}}else oe=()=>()=>{};return oe(n,e)};function gt(n,e,t,i){return k.get(n,e,t,i)}function Xt(){k.disposeAll()}function Zt(n,e){return new Ue(n,e)}function ei(n,e,t){return new Je(new Ft(n,t),e)}function ti(n,e,t,i){return new Je(new Dt(e,t,i),n)}function G(n){return!!n.fn}class ft{constructor(){this.events={},this.eventCount=0,this.addListener=this.on,this.off=this.removeListener}addListenerCore(e,t,i){if(typeof t!="function")throw new TypeError("Listener must be a function");const s=this.events[e],r={fn:t,once:i};return s?G(s)?this.events[e]=[s,r]:s.push(r):(this.events[e]=r,this.eventCount++),this}removeListenerCore(e,t,i){const s=this.events[e];if(!s)return this;if(G(s))i(s,t)&&this.removeEvent(e);else for(let r=s.length-1;r>=0;r--)if(i(s[r],t)){s.splice(r,1),s.length?s.length===1&&(this.events[e]=s[0]):this.removeEvent(e);break}return this}removeEvent(e){--this.eventCount===0?this.events={}:delete this.events[e]}on(e,t){return this.addListenerCore(e,t,!1)}once(e,t){return this.addListenerCore(e,t,!0)}removeListener(e,t){if(typeof t!="function")throw new TypeError("Listener must be a function");return this.removeListenerCore(e,t,(i,s)=>i.fn===s)}removeAllListeners(e){return e?this.events[e]&&this.removeEvent(e):(this.events={},this.eventCount=0),this}listeners(e){const t=this.events[e];if(!t)return[];if(G(t))return[t.fn];const i=t.length,s=new Array(i);for(let r=0;r<i;r++)s[r]=t[r].fn;return s}listenerCount(e){const t=this.events[e];return t?G(t)?1:t.length:0}eventNames(){const e=[];if(this.eventCount===0)return e;const t=this.events;for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.push(i);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e}emit(e,t,i,s,r,...o){let a=this.events[e];if(!a)return!1;let l,c;G(a)?[l,c]=[a,1]:(a=a.slice(),[l,c]=[a[0],a.length]);const u=arguments.length-1;for(let g=0;;){switch(l.once&&this.removeListenerCore(e,l,(f,d)=>f===d),u){case 0:l.fn.call(this);break;case 1:l.fn.call(this,t);break;case 2:l.fn.call(this,t,i);break;case 3:l.fn.call(this,t,i,s);break;case 4:l.fn.call(this,t,i,s,r);break;default:const f=new Array(u);for(let d=0;d<u;d++)f[d]=arguments[d+1];l.fn.apply(this,f);break}if(++g>=c)break;l=a[g]}return!0}}class ae{static setup(e,t){const i=(t??ii)();return i&&(e.defaultCacheFactory=s=>new me(new ae(i),s.logger)),e}constructor(e){this.storage=e}set(e,t){this.storage.setItem(e,ni(t))}get(e){const t=this.storage.getItem(e);if(t)return si(t)}}function ii(){const n="__configcat_localStorage_test";try{const e=window.localStorage;e.setItem(n,n);let t;try{t=e.getItem(n)}finally{e.removeItem(n)}if(t===n)return e}catch{}return null}function ni(n){return n=encodeURIComponent(n),n=n.replace(/%([0-9A-F]{2})/g,(e,t)=>String.fromCharCode(parseInt(t,16))),btoa(n)}function si(n){return n=atob(n),n=n.replace(/[%\x80-\xFF]/g,e=>"%"+e.charCodeAt(0).toString(16)),decodeURIComponent(n)}class dt{handleStateChange(e,t,i){var s;try{if(e.readyState===4){const{status:r,statusText:o}=e;if(r===200){const a=(s=e.getResponseHeader("ETag"))!==null&&s!==void 0?s:void 0;t({statusCode:r,reasonPhrase:o,eTag:a,body:e.responseText})}else r&&t({statusCode:r,reasonPhrase:o})}}catch(r){i(r)}}fetchLogic(e,t){return new Promise((i,s)=>{try{e.logger.debug("HttpConfigFetcher.fetchLogic() called.");const r=new XMLHttpRequest;r.onreadystatechange=()=>this.handleStateChange(r,i,s),r.ontimeout=()=>s(new N("timeout",e.requestTimeoutMs)),r.onabort=()=>s(new N("abort")),r.onerror=()=>s(new N("failure"));let o=e.getUrl();t&&(o+="&ccetag="+encodeURIComponent(t)),r.open("GET",o,!0),r.timeout=e.requestTimeoutMs,r.send(null)}catch(r){s(r)}})}}class ri{async fetchLogic(e,t){var i,s,r;const o={method:"GET"};let a;if(typeof AbortController<"u"){const l=new AbortController,c=setTimeout(()=>l.abort(),e.requestTimeoutMs);o.signal=l.signal,a=()=>clearTimeout(c)}else a=()=>{};try{let l=e.getUrl();t&&(l+="&ccetag="+encodeURIComponent(t));const c=await fetch(l,o),{status:u,statusText:g}=c;if(u===200){const f=await c.text(),d=(s=(i=c.headers)===null||i===void 0?void 0:i.get("Etag"))!==null&&s!==void 0?s:void 0;return{statusCode:u,reasonPhrase:g,eTag:d,body:f}}else return{statusCode:u,reasonPhrase:g}}catch(l){throw l instanceof DOMException&&l.name==="AbortError"?!((r=o.signal)===null||r===void 0)&&r.aborted?new N("timeout",e.requestTimeoutMs):new N("abort"):new N("failure",l)}finally{a()}}}const oi=Object.freeze(Object.defineProperty({__proto__:null,DefaultEventEmitter:ft,ExternalConfigCache:me,FetchApiConfigFetcher:ri,FetchError:N,FetchResult:I,get FetchStatus(){return ce},InMemoryConfigCache:Me,LocalStorageCache:ae,XmlHttpRequestConfigFetcher:dt,createConsoleLogger:Zt,createFlagOverridesFromMap:ei,createFlagOverridesFromQueryParams:ti,disposeAllClients:Xt,getClient:gt},Symbol.toStringTag,{value:"Module"})),ai="2.4.2",li={install:(n,e)=>{const{sdkKey:t,pollingMode:i,clientOptions:s}=e,r=ae.setup({sdkType:"ConfigCat-Vue",sdkVersion:ai,configFetcher:new dt,eventEmitterFactory:()=>new ft}),o=gt(t,i??h.PollingMode.AutoPoll,s,r);n.provide("configCatClient",o);const a=n.unmount;n.unmount=function(){a.apply(arguments),o.dispose()}}},ci=T.defineComponent({__name:"FeatureWrapper",props:{featureKey:{},userObject:{}},emits:["flagValueChanged"],setup(n,{emit:e}){const t=e,i=n,s=T.ref(null),r=T.inject("configCatClient")??(()=>{throw new Error("ConfigCatPlugin was not installed.")})(),o=()=>{const l=r.snapshot().getValue(i.featureKey,!1,i.userObject);s.value!==l&&(s.value=l,t("flagValueChanged",l))};return T.onBeforeMount(()=>{const a=r.snapshot(),l=a.cacheState;l==h.ClientCacheState.HasUpToDateFlagData||l==h.ClientCacheState.HasLocalOverrideFlagDataOnly?(s.value=a.getValue(i.featureKey,!1,i.userObject),r.on("configChanged",o)):r.getValueAsync(i.featureKey,!1,i.userObject).then(c=>{const u=o;u&&(s.value=c,r.on("configChanged",u))})}),T.onUnmounted(()=>{r.off("configChanged",o)}),(a,l)=>s.value===!0?T.renderSlot(a.$slots,"default",{key:0}):s.value===!1?T.renderSlot(a.$slots,"else",{key:1}):T.renderSlot(a.$slots,"loading",{key:2})}}),{createConsoleLogger:ui,createFlagOverridesFromMap:hi,createFlagOverridesFromQueryParams:gi}=oi;h.ConfigCatPlugin=li,h.ConfigJson=yt,h.FeatureWrapper=ci,h.FormattableLogMessage=m,h.RefreshResult=R,h.SettingKeyValue=q,h.User=Bt,h.createConsoleLogger=ui,h.createFlagOverridesFromMap=hi,h.createFlagOverridesFromQueryParams=gi,Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})});
